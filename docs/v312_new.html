<html>
<head>
<title>What's New in Synchronet v3.12 (Change History)</title>
</head>
<body>
<font face=Arial,Helvetica>
<h1 align=center>What's New in Synchronet v3.12</h1>
<ul>
<li><b>Web Server</b> (New!)<ul>
	<li>HTTP 1.0 and 1.1
	<li>Virtual Hosts
	<li>CGI (currently on Unix only)
	<li>Server-side JavaScript (SSJS) for dynamically-generated web content
	<li>Default HTML user interface for creating new user accounts and reading messages
	<li>Standard format HTTP access logs (<tt>data/logs/http-*</tt>)
	<li>Configurable MIME file type support (<tt>ctrl/mime_types.ini</tt>)
	<li>... and many more cool features thanks to Stephen Hurd (Deuce)
	</ul><br>
<li><b>Mail Server</b><ul>
	<li>Supports SMTP authentication (PLAIN, LOGIN, or CRAM-MD5) when using an external relay server
	<li>Creates default MIME Content-Type for non-Internet messages (<tt>charset=IBM437</tt>)
	<li>Supports <tt>user@[<i>ip_address</i>]</tt> notation
	<li>Supports RFC822 header fields in <tt>Field<i>[white-space]</i>:</tt> format
	<li>Fixed receipt of SMTP telegrams (inter-BBS instant-messages)
	<li>Fixed possible buffer overflow scenarios
	<li>Fixed UDP DNS MX-record look-up bug
	<li>If posting via authenticatd SMTP (e.g. <tt>sub:code@yourbbs.com</tt>), verifies user meets access requirements
	<li>Much-improved external mail processor support using new <tt>ctrl/mailproc.ini</tt><ul>
		<li>Or <tt>ctrl/mailproc.<i>host</i>.ini</tt> if it exists
		<li>Includes ListServer module as example mail processor
		<li>See <a href=listserver.txt>listserver.txt</a> for details
		</ul>
	<li>Mail processors may run only for specific recipients (or a set of recipients)
	<li>Additional mail processor command-line specifiers:<ul>
		<li><tt>%R</tt> (Reverse path)
		<li><tt>%S</tt> (Sender's name)
		<li><tt>%A</tt> (Sender's address)
		</ul>
	<li>JavaScript mail processor modules:<ul>
		<li>can now use <tt>log()</tt> to write to the mail server log window<br>
			(AKA <tt>write</tt>, <tt>writeln</tt>, and <tt>print</tt>)
		<li>have access to global variables: <tt>sender_name</tt>, <tt>sender_address</tt>, and <tt>reverse_path</tt>
		</ul>
	</ul><br>
<li><b>Telnet/RLogin Server</b><ul>
	<li>Telnet option negotiation overhaul:<ul>
		<li>Compatibility with more clients
		<li>Gets/stores terminal type
		<li>Supports negotiated window size (much more reliable than ANSI cursor position reports)
		</ul>
	<li>Telnet server now escapes the telnet IAC (ASCII 255) character
	<li>Many RLogin improvements and behavior changes (ask Deuce for details)
	<li>Switched "Allowed RLogin address list" from <tt>data/rlogin.can</tt> to <tt>ctrl/rlogin.cfg</tt>
	<li>QWK/REP packing/unpacking semaphore file allows multiple hosts to process QWK events (for FTP server)
	<li>Counts and logs number of "short sends" on client socket
	<li>Fixed crashes/segfaults when re-loading configuration files
	<li>Fixed "Monitor Time Left" external program toggle option
	<li>Fixed calculation of upload/download and post/call ratios over 50% in Access Requirement Strings
	<li>Beeps at user when reaching end of allowed string input
	<li>Batch download file list now contains the long filenames if the file transfer protocol is "Native 32-bit"
	<li>Rejects filenames begining with a dash as a "suspicious filename"
	<li>Use default <tt>SHELL</tt> value of <tt>/bin/sh</tt> if environment variable not set for Unix version
	<li>Created <tt>PROT</tt> ARS keyword (e.g. "Telnet" or "RLogin")
	<li>The <tt>%p</tt> command-line specifier now expands to the client's protocol (e.g. "Telnet" or "RLogin")
	<li>Allow spinning cursor to be completely disabled by users (even for pause prompts)
	<li><tt>input_thread_mutex</tt> lock fix (work-around necessary for some Linux distros)
	<li>Eliminated hard-coded "Continue?" prompt during new user procedure, using text.dat line 564 instead
	</ul><br>
<li><b>FTP Server</b><ul>
	<li>Supports both shared and non-shared open modes when sending files (for download)
	<li>Guest/anonymous HTML clients can now toggle on/off extended file descriptions in <tt>00index.html</tt>
	<li>Don't update existing (pre-packed?) QWK packet when downloading or "sizing" a QWK packet via FTP
	</ul><br>
<li><b>Synchronet Services</b><ul>
	<li>Configurable stack size for service threads
	<li>Improved <tt>client_add()</tt> and <tt>client_remove()</tt> methods
	<li>Eliminated support for legacy <tt>ctrl/services.cfg</tt><ul>
		<li>Must use <tt>ctrl/services.ini</tt> or <tt>ctrl/services.<i>host</i>.ini</tt> now
		</ul>
	<li>Fixed termination request with active clients
	</ul><br>
<li><b>All Servers</b><ul>
	<li>Automatic bind-retry on failure (typically, "address/port already in use")
	<li>Much more flexible semaphore file format for recycling or shutting-down servers using the local file system<ul>
		<li>Format: <tt>ctrl/<i>action</i>[.<i>host</i>][.<i>service</i>]</tt>
		<li>Examples:<ul>
			<li><tt>ctrl/recycle</tt> - recycle all services on all hosts
			<li><tt>ctrl/recycle.vert</tt> - recycle all services on system with hostname "vert"
			<li><tt>ctrl/shutdown.vert.telnet</tt> - shutdown telnet service on vert only
			<br>
			<i>service</i> may be "telnet", "ftp", "mail", "web" or "services"
			</ul>
		<li>Legacy (<tt>ctrl/*.rec</tt>) recycle semaphore files still supported
		</ul>
	<li>Startup initialization file (<tt>ctrl/sbbs.ini</tt>) is re-parsed upon server recycle
	<li>Much more responsive to requests for termination (immediate) and shutdown (when not in use)
	</ul><br>
<li><b>Message Bases</b> (SMBLIB v2.40)<ul>
	<li>Performance and reliability improvements
	<li>The e-mail message base (<tt>data/mail</tt>) now supports an unlimited number of messages (within SMB limits)
	<li>High-level functions added for the convenience of 3rd party developers
	<li>New security header fields track who posted what messages from where
	<li>New hash database<ul>
		<li>to perform fast look-ups of message-IDs for threading and duplicate checking
		<li>robust body text dupe checking (better than legacy CRC history method)
		<li>hash history file is never purged or deleted so old dupes cannot return
		<li>no chance for false positives
		</ul>
	<li>Auto-thread linkage<ul>
		<li>resulting thread-links will be used extensively in future threaded message displays (ala web-boards)
		</ul>
	<li>New SMBUTIL commands:<ul>
		<li><tt>d</tt> delete all messages
		<li><tt>h</tt> dump hash database
		</ul>
	<li>New SMBUTIL options:<ul>
		<li><tt>-c[m]</tt> create message base if it doesn't exist (m=max msgs)
		<li><tt>-l</tt> LZH-compress imported message text
		<li><tt>-o</tt> print errors on stdout (instead of stderr)
		<li><tt>-p</tt> wait for keypress (pause) on exit
		<li><tt>-!</tt> wait for keypress (pause) on error
		<li><tt>-b</tt> beep on error (quiet is now the default)
		</ul>
	<li>New CHKSMB options:<ul>
		<li><tt>-b</tt> beep on error (quiet is now the default)
		<li><tt>-h</tt> do not check hash database
		</ul>
	<li>FIXSMB may now be used to repair multiple message bases with a single command<br>
		Example: <tt>fixsmb data/*.shd</tt>
	<li>FIXSMB now removes "in-transit" attributes (holding messages in the mail server queue)
	<li>FIXSMB will now add message hashes to the hash database (if missing)
	</ul><br>
<li><b>JavaScript</b><ul>
	<li>JSexec new global methods:<ul>
		<li><tt>chdir()</tt> (change current directory)
		<li><tt>putenv()</tt> (create/set environment variable)
		</ul>
	<li>Background (multi-threaded) script support using <tt>load(true, <i>filename, args</i>)</tt>
	<li>New <a href=v312_jsnew.html#Queue>Queue</a> class for bi-directional communications between modules/threads
	<li>New <tt>bbs.mods</tt> object for a common global repository for 3rd party modifications/modules
	<li>Reduced memory usage (using the undocumented JSPROP_SHARED attribute for properties)
	<li><tt>MsgBase.save_msg()</tt> will accept any variable type for the body text<br>
		and will automatically convert to a string (even arrays of objects)
	<li>For a complete list of JavaScript Object Model changes, see <a href=v312_jsnew.html>v312_jsnew.html</a>
	</ul><br>
<li><b>Full-screen Utilities</b> (e.g. SCFG, EchoCfg, etc.)<ul>
	<li>Mouse support returns to Win32
	<li>Strings longer than the screen width can now be edited
	<li>Support ANSI terminals (remote input doesn't currently work on NT-based OSes)
	<li>Support X consoles on Unix
	<li>Compatibility with terminals/keyboards lacking some extended keys.<br>
	The following are now equivalanet in ulist (menus) and string input:<ul>
		<li>^B = home
		<li>^E = end
		<li>^V = insert (string input only)
		<li>^Z = help (F1)
		</ul>
	and in menus only:<ul>
		<li>+ = insert
		<li>- = delete
		<li>backspace = escape (not new)
		<li>^U = pgup
		<li>^D = pgdn
		<li>^C = copy (F5)
		<li>^V = paste (F6)
		</ul>
	<li>... and many more cool features thanks to Stephen Hurd (Deuce)
	</ul><br>
<li><b>Windows NT Services</b><ul>
	<li>Supports mute/umute and sysop available/unavailable control from the Synchronet Control Panel
	<li>Event log messages no longer contain warnings about "missing event source descriptions"
	</ul><br>
<li><b>Synchronet Control Panel (for Win32)</b><ul>
	<li>Now stores common server settings in <tt>ctrl/sbbs.ini</tt> instead of Windows Registry<ul>
		<li>Legacy registry settings are automatically imported
		<li>Allows easy interoperation with <tt>sbbsNTsvcs.exe</tt> and <tt>sbbs.exe</tt>
		<li>The startup .ini file can now be specified on the <tt>sbbsctrl.exe</tt> comand-line
		<li>Will use <tt>ctrl/<i>host</i>.ini</tt> by default, if it exists
		</ul>
	<li>Optionally use Windows file associations when editing or viewing text/ansi/ascii files
	<li>Synchronet Control Panel configuration (window sizes/positions/colors, etc) may be exported-to<br>
	or imported-from <tt>ctrl/sbbsctrl.ini</tt>
	</ul><br>
<li><b>Synchronet Console</b><ul>
	<li>Added commands:<ul>
		<li>(R)ecycle/(S)hutdown/(T)erminate any server (or all servers)
		<li>(!) to execute an external (system) command
		</ul>
	</ul>
</ul>
<a name=b>
<h1 align=center>What's New in Synchronet v3.12b</h1>
</a>
<ul>
<li><b>All Servers</b><ul>
	<li>Overhaul of temporary directory usage:<br><ul>
		<li>No more temp files in <tt>data</tt> or <tt>data/temp</tt><br>
			<tt>ctrl_dir/../temp</tt> (e.g. <tt>sbbs/temp</tt>) is the new default location for temporary files
		<li>Each server has its own separately configurable temp dir (in <tt>ctrl/sbbs.ini</tt>)
		<li>BBS events (e.g. QWK packet processing) now have their own exclusive-use
			temp dir (e.g. <tt>sbbs/temp/event</tt>)
		<li>All server threads will attempt to create and verify the validity of their temp dir
		<li>The system temp directory is only used as the default temp dir for Unix (i.e. <tt>/tmp</tt>)<br>
			since the Windows default temp dir (e.g. <tt>C:\DOCUME~1\Rob\LOCALS~1\Temp</tt>) is not
			particularly friendly or attractive
		</ul>
	<li>The startup/initialization file can now be<br>
		<tt>ctrl/sbbs<i>[.host | .platform]</i>.ini</tt> or <tt>ctrl/startup<i>[.host | .platform]</i>.ini</tt>
	</ul><br>
<li><b>Web Server</b><ul>
	<li>Win32-CGI support (tested with php-cgi.exe)
	<li>Created <tt>ctrl/cgi_env.ini</tt> which dictates which system environment variables
	will be passed to CGI processes and which default or forced values they will have
	<li>Default CGI content-type is now configurable via sbbs.ini [web] DefaultCGIContent (defaults to "text/plain")
	<li>Added CGI environment variable REDIRECT_STATUS=200 for php-cgi kludge (thx Deuce)
	<li>Added non-standard (Apache) SCRIPT_FILENAME env variable required by PHP-CGI
	<li>Bug-fix: default server-side JavaScript file extension (".ssjs", not "ssjs")
	<li>Bug-fix: removed ":port" specification from vhost paths
	<li>When logging and using virtual hosts, log every virtual host in it's own
		separate file in the format: <tt>(prefix)vhostname-date.log</tt>
	<li>Renamed sbbs.ini [web] CgiTempDirectory to just TempDirectory (this directory is
		actually used for SSJS, not CGI)
	<li>Work-around: chdir() to ctrl_dir during initialization
		<br>Deuce's .ssjs files
		make assumptions about the cwd when opening files
	<li>Created global JS variables: <i>web_root_dir</i> and <i>web_error_dir</i><br>
		to be used in the
		future instead of assuming that <tt>"../web/.."</tt> will be the correct location of a
		specific file
	<li>Created global JS <i>log()</i> function (like all good servers should have)
	<li>JS <i>print()</i> is an alias for <i>writeln()</i>
	<li>Bug-fix: JS <i>write()</i> and <i>writeln()</i> methods must return string written
		as other servers' implementations do
	<li>Add support for streaming-style <tt>.ssjs</tt> files<br>If you set <i>http_reply.fast</i> to
		<i>true</i> BEFORE the first <i>write()</i>, the first write will send the headers and
		every write will go throug the socket immediately.  This will make large 
		<tt>.ssjs</tt> files appear to be faster (ie: Large user lists etc.)
	<li>CGI scripts now have STDIN directly from the socket. File uploads should
		work again now
	<li>If a CGI script sends the LENGTH header, turn keep-alives on
	<li>New <tt>formmail.ssjs</tt> script to emulate Matt Wright's <tt>FormMail.pl</tt> script
	<li>New <tt>404.ssjs</tt> file to display directory contents
		[<a href=http://vert.synchro.net/Synchronet>example</a>]
	<li>Bug-fix: numerous memory leaks were present due to things being allocated, and structures being
		zeroed every time through the redirect loop instead of per-request
	<li>Added external web-content handler support using <tt>ctrl/web_handler.ini</tt><br>
		This should allow for competing dynamic HTML solutions based on server-side
		JavaScript (e.g. <tt>.xjs</tt>).<br>
		Tip: use <i>http_request.real_path</i> for the path to file-to-be-parsed<br>
		This should also allow php-cgi.exe (for example) to automatically handle .php files
	<li>Bug-fix: when logging failed login attempt, was logging wrong password variable
	</ul><br>
<li><b>Mail Server</b><ul>
	<li>Numerous External Mail Processor (<tt>mailproc.ini</tt>) related bug-fixes
	<li>Set the "reply-to" header field on outbound mail if the local sender has their account configured to
		forward received mail to a valid netmail address
	<li>SMTP <tt>RCPT TO</tt> command now fails if no recipient specified
	<li>Represent FidoNet addresses in From: header fields using "name" <ftn_addr>
		notation (for Deuce)
	<li>Bug-fix: use EHLO for SMTP relay attempts using SMTP authentication (which requires
		the ESMTP extensions implied by the "EHLO" command)
	<li>Bug-fix: handle received multiple-hop (routed) QWK netmail correctly
	<li>If sending to a domain your system handles (i.e. system inetaddr or system host name
		or in <tt>domains.cfg</tt>), connect to the local SMTP server, by interface IP if server is  
		bound to a specific IP, or "127.0.0.1" if it is not
	</ul><br>
<li><b>FTP Server</b><ul>
	<li>Now supports configurable IP address to use in PASV responses
		(for broken firewall/NAT devices) and PASV port ranges (default is 1024-65535)<br>
		See <a href="tcpip_faq.html#ftp_nat">tcpip_faq.html</a> for details
	<li>Added kludge required to work-around SMC Barricade router P@SW bug
	<li>Bug-fix: not allowing simultaneous downloads of the same file
	<li>Support "LIST -opts" command in local file system mode
	<li>Create tempory transfer files in the (*gasp*) temporary directory (instead of data directory)
	<li>Use more unique temporary transfer filenames (includes the local hostname)
	<li>If an aliased file or directory has a description of "hidden", don't display it
		in directory listings
	<li>Created <tt>exec/ftp-web-html.js</tt> for sysops running the Synchronet Web Server<br>
		Uses HTTP for CSS and image files. Edit <tt>ctrl/sbbs.ini</tt> to use <tt>ftp-web-html.js</tt> instead of
		the default <tt>ftp-html.js</tt>
	</ul><br>
<li><b>Telnet/RLogin Server</b><ul>
	<li>Bug-fix: the Win32 list long filename feature didn't work correctly with filenames with
		a less than 8 char base name
	<li>Bug-fix: if a file with a long filename was blind uploaded
		(e.g. with <i>SEXYZ</i> or <i>rz</i>), then it would not be properly added to the database
		(but the file would be copied to the destination directory)
	<li>Bug-fix: moving a file between directories would use the Micros~1 shortened version of the filename
	<li>When uploading a file, if no description is given, use the filename
		(rather than "No description given") if the real filename is different than
		the one in the database (e.g. it's a long filename)
	<li>Now passes QWKnet hub name as <tt>%s</tt> on QWKnet call-out command-line
	<li>Bug-fix: qnet-ftp will only delete the .REP packet if it was sent successfully
	<li>Delete/ignore the file ATTXREF.DAT if included in .REP packets
	<li>Ignore the "Your Messages Only" scan configuration flag for QWKnet accounts
	<li>Don't ask "Your Messages Only" during scan configuration for QWKnet accounts
	<li>Bug-fix: when answering 'No' to the "Use an external text editor?" new user question, it would
		not force the editor to the internal line editor
	<li>Bug-fix: hitting 'Q' from the external editor selection dialog,
		the current editor would be changed anyway
	<li>Bug-fix: allow control keys (e.g. Ctrl-U) to have effect while waiting for paged node to respond
	<li>Bug-fix: buffer overflow (segfault) in temp directory section
	<li>Subtle Bug-fix: when executing a native external program, the server process's
		environment is no longer modified to set variables in the spawned process's
		environment. This could result in a race condition where if multinodes executed
		native externals simultaneously, one node's child process could get the wrong
		node number (SBBSNNUM) or node directory (SBBSNODE) value (in theory).
		We now use cool new string list functions to copy and append string blocks
		to copy  the environment of the server before modifying and passing to the
		child process. This Bug-fix only applies to Win32 builds
	<li>Changed parsing of DSZLOG (protocol.log) to account for long filenames and
		filenames with spaces in them
	<li>Fix ups for new user creation via RLogin (Deuce)
	<li>Bug-fix: don't upper-case the path when it's input for a new file in a text file section
	</ul><br>
<li><b>JavaScript</b><ul>
	<li>Bug-fix: predictable random numbers be returned from random()
	<li>Bug-fix: <i>system.newuser_password</i> and <i>system.newuser_magic_word were</i> reversed
	<li>Bug-fix: <i>Queue</i> objects can now have <i>null</i> encoded/enqueued and dequeued
		without converting to an empty object or segfaulting
	<li>Bug-fix: a background-executed script (via <tt>load(true,...)</tt>) was not enqueueing
		the result of the last evaluated statement if it was <i>undefined</i><br>
		(some functions return <i>undefined</i> on failure)
	<li>Bug-fix: corrected <i>link</i> property for directories in libraries that use a "code prefix"
		(the prefix isn't used in the FTP virtual directories)
	<li>JSexec-Unix: a <tt>SIGHUP</tt> will cause a recycle/re-run
	<li>JSexec: added '-f' option to force console output stream to non-buffered
	<li>JSexec: added '-S' option to set thread stack size limit, default is 256K bytes<br> 
		This should keep JSexec from crashing due to the ircd recursion bug. It'll log a JS
		exception/error and exit (or loop) instead. Use '-S0' to set an unlimited
		thread stack size
	<li>JSexec: if error and console messages are redirected to files (using -e and -o options)
		echo error messages to status output (default: stderr) as well
	<li>All string-modification methods now return undefined if passed an undefined
		value (rather than converting to the string "undefined")
	<li>Enhancements: <i>Queue.peek()</i> and <i>Queue.read()</i> now support an optional timeout
		argument (in milliseconds)
	<li><i>bbs.get_newscantime()</i> now returns <i>null</i> on abort instead of <i>undefined</i><br>
		It's been determined that <i>null</i> is the better error return value for functions
		(for one, it's easier to to enqueue/dequeue)
	<li>Always enqueue the result of a background-executed script (even if it fails with an
		error)<br>
		If an argument is passed to <i>exit()</i>, enqueue that value instead
	<li>Defined new global variable <i>socket_errno</i>, for debugging socket errors without an
		associated Socket object<br>
		(e.g. failed <i>resolve_ip()</i> or <i>resolve_host()</i> calls)<br>
		On *nix, this
		value will be the same as <i>errno</i>, but on Win32, it will be different
	<li>New global function: <i>flags_str()</i> to convert string flag representations
		(e.g. "A-Z") to/from numeric representation (used in the <i>user.security</i>
		properties)
	<li>If a <i>Date</i> object is passed as the default value to <i>File.iniGetObject()</i>, return
		a <i>Date</i> object
	</ul><br>
<li><b>SBBSecho</b><ul>
	<li>Work-around for BRE/FE inter-BBS attachment bug (remove pre-pended '^' from attached filename)
	<li>Fix case of attached files before placing in .?LO files (for Unix file system compatibility)
	</ul><br>
<li><b>Synchronet Console</b><ul>
	<li>Bug-fix: for log output, display control characters in ^X format<br>
		(ths should fix the mystery termination bug when ran from xterm and logging a Ctrl-E char)
	<li>Bug-fix: don't over-ride the Unix syslog facility type when using the 'sbbs -d' option
		and no facility type was specified
	<li>Allow the Unix syslog identity to be configurable using the sbbs.ini [Unix] LogIdent key
	</ul><br>
<li><b>Synchronet Control Panel (for Win32)</b><ul>
	<li>Bug-fix: hostname being set to "(null)" when importing registry settings from v3.00-v3.11
	<li>List of web server index files is now configurable
	<li>External changes to <tt>ctrl/sbbs.ini</tt> are now loaded when starting servers
	<li>Bug-fix: restore the current working dir (ctrl dir) when done selecting sound
		files from configuration dialogs
	<li>Don't add selected sound files to recent documents history
	<li>Only request the minimum required security access in SCM calls<br>
		This allows <tt>sbbsctrl.exe</tt> to be run by non-admin users and still start/stop/monitor
		Synchronet NT Services
	</ul><br>
<li><b>Synchronet NT Services</b><ul>
	<li>If [-]help or [-]? is passed on the command-line, no longer attempts to start
		service control dispatcher (just displays usage)
	<li>Usage is no longer displayed if the service control dispatcher is started successfully
	<li>"/options" are supported (as well as "-options" and just "options")
	<li>When re-enabling a disabled service, sets the service's start type to "auto" or
		"manual" based on the AutoStart settings in the startup .ini file
	<li>Added "start" and "stop" commands to easily start and stop one or all services using sbbsNTsvcs
	<li>Allow short-hand service names on command-line (e.g. just "BBS" instead of "SynchronetBBS")
	</ul><br>
<li><b>CHKSMB</b><ul>
	<li>Detect and report number of "in-transit" messages
	<li>Detect and report number of unvalidated moderated messages
	</ul><br>
<li><b>Documentation</b><ul>
	<li>The ListGate module (exec/listgate.js) is now documented in docs/listgate.txt
	<li>Fixed JS documentation error: default timeout value for <i>Queue.poll()</i> is <i>0</i>, not
		<i>infinite</i>
	</ul><br>
</ul>
For <b>many</b> more changes since v3.10, see <a href=v311_new.html>v311_new.html</a> and
<a href=v311_jsnew.html>v311_jsnew.html</a>
<p align="right"><font face="Arial" size="1" , "Helvetica">Copyright © 2005 Rob 
Swindell <br>
&nbsp;$Id$</font></p>

</body>
</html>